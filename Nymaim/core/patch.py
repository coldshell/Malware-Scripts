from core.color import Color
from miasm2.core.locationdb import LocationDB


class Patch:
    def __init__(self, sb):
        self.sb = sb
        self.pe = self.sb.pe

    def nop_range(self, start, end):
        self.pe.virt.set(start, '\x90'*(end-start))

    def patch(self, start, end, str_inst):
        mn = self.sb.machine.mn
        loc_db = LocationDB()
        opcode = mn.asm(mn.fromstring(str_inst, loc_db, 32))[0]

        if len(opcode) <= (end-start):
            self.pe.virt.set(start, opcode)
        else:
            print Color.error("Can't patch not enough space")
